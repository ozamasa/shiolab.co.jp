---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { fetchAllArticles, normalizeCategory } from "../../lib/microcms";

const articles = (await fetchAllArticles()).sort(
  (a, b) =>
    new Date(b.date || b.publishedAt || b.createdAt || 0).getTime() -
    new Date(a.date || a.publishedAt || a.createdAt || 0).getTime()
);
---

<BaseLayout
  title="記事一覧｜LOGICLAB"
  description="LOGICLABの記事一覧ページです。資格試験・受験対策に役立つ攻略パターンをまとめています。"
>
  <section class="hero">
    <div class="heroInner">
      <p class="kicker">攻略パターン</p>
      <h1>記事一覧</h1>
      <p class="lead">公開中の記事を新しい順に掲載しています。</p>
      <div class="heroCta">
        <a class="btn" href="/">トップへ戻る</a>
        <a class="btn" href="/quiz/">クイズへ</a>
      </div>
    </div>
  </section>

  {articles.length === 0 ? (
    <section class="card section">
      <p>まだ記事がありません。</p>
    </section>
  ) : (
    <section class="grid section">
      {articles.map((a) => {
        const cat = normalizeCategory(a.category);
        const dateText = (a.date || a.publishedAt || a.createdAt || "").toString();

        return (
          <article class="card">
            <h2 style="margin:0 0 10px; font-size:18px;">
              <a class="cardLink" href={`/articles/${a.id}/`}>{a.title}</a>
            </h2>

            {a.description ? (
              <p class="muted" style="margin:0 0 14px; line-height:1.8;">
                {a.description}
              </p>
            ) : null}

            <div class="metaRow" style="margin-top:0;">
              {cat ? (
                <span class="metaItem">
                  カテゴリ：
                  <a href={`/category/${cat.slug}/`}>{cat.label}</a>
                </span>
              ) : (
                <span class="metaItem">カテゴリ：未設定</span>
              )}
              {dateText ? <span class="metaItem">更新：{dateText.slice(0, 10)}</span> : null}
            </div>

            <div style="margin-top:14px;">
              <a class="btn btnSmall" href={`/articles/${a.id}/`}>続きを読む</a>
            </div>
          </article>
        );
      })}
    </section>
  )}
</BaseLayout>
