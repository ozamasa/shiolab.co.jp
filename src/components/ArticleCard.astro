---
import type { MicroCMSArticle } from "../lib/microcms";
import { normalizeCategories } from "../lib/microcms";

const { item } = Astro.props as { item: MicroCMSArticle };

// idベースでリンク（slugだと404になりやすい）
const href = `/articles/${item.id}/`;

// カテゴリを配列で正規化（複数カテゴリ対応）
const cats = normalizeCategories(item.category);
const shown = cats.slice(0, 2);
const rest = cats.length - shown.length;

const dateText = (item.date || item.publishedAt || item.createdAt || "").toString();
---

<article class="card card--article">
  <h3 class="cardTitle">
    <a href={href}>{item.title ?? "（無題）"}</a>
  </h3>

  {item.description ? (
    <p class="cardDesc">{item.description}</p>
  ) : null}

  <div class="meta">
    {shown.map((c) => (
      <a class="pill" href={`/category/${c.slug}/`} aria-label={`カテゴリ：${c.label}`}>
        {c.label}
      </a>
    ))}
    {rest > 0 ? <span class="pill pill--muted">+{rest}</span> : null}

    {dateText ? (
      <span class="pill pill--muted">
        <span style="opacity:.75;">更新</span>
        {dateText.slice(0, 10)}
      </span>
    ) : null}
  </div>
</article>
