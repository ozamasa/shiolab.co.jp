---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { fetchAllArticles } from "../../lib/microcms";

// 静的生成に必須
export async function getStaticPaths() {
  const articles = await fetchAllArticles();

  // categoryは「文字列」に正規化
  const categorySet = new Set<string>();

  for (const article of articles) {
    if (article.category && typeof article.category === "string") {
      categorySet.add(article.category);
    }
  }

  return Array.from(categorySet).map((cat) => ({
    params: {
      category: cat, // ← 文字列のみ
    },
  }));
}

// URLパラメータ取得
const { category } = Astro.params;

// 全記事取得
const allArticles = await fetchAllArticles();

// 該当カテゴリのみ抽出
const filtered = allArticles.filter(
  (a) => a.category === category
);
---

<BaseLayout title={`${category}の記事一覧｜SHIOLAB`}>

  <section class="card">
    <h1>{category}</h1>
    <p>{category}に関する攻略記事の一覧です。</p>
  </section>

  {filtered.length === 0 ? (
    <section class="card">
      <p>まだ記事がありません。</p>
    </section>
  ) : (
    <section class="grid">
      {filtered.map((article) => (
        <article class="card">
          <h3 style="margin:0 0 8px;">
            <a href={`/articles/${article.id}/`}>
              {article.title}
            </a>
          </h3>

          {article.description ? (
            <p style="font-size:14px; color:#666;">
              {article.description}
            </p>
          ) : null}
        </article>
      ))}
    </section>
  )}

</BaseLayout>