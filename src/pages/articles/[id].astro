---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { microcms, normalizeCategory } from "../../lib/microcms";

export async function getStaticPaths() {
  if (!microcms) return [];

  const res = await microcms.getList({
    endpoint: "articles",
    queries: { limit: 100, fields: "id" },
  });

  return res.contents.map((a) => ({
    params: { id: a.id },
  }));
}

const { id } = Astro.params;

if (!microcms) throw new Error("microCMS未設定");

const article = await microcms.getListDetail({
  endpoint: "articles",
  contentId: id,
});

const categories = normalizeCategory(article.category);
---

<BaseLayout title={article.title} description={article.description}>
  <article class="card">
    <h1>{article.title}</h1>

    {categories.length > 0 && (
      <p style="font-size:14px;color:#666;">
        カテゴリ：
        {categories.map((c) => (
          <>
            <a href={`/category/${encodeURIComponent(c)}/`}>{c}</a>{" "}
          </>
        ))}
      </p>
    )}

    <div set:html={article.body} />
  </article>
</BaseLayout>