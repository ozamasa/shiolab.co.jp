---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getArticleSlugs, getArticleBySlug, microcmsEnabled } from '../../lib/content.js';

export async function getStaticPaths() {
  const slugs = await getArticleSlugs();
  return slugs.map((slug) => ({ params: { slug } }));
}

const { slug } = Astro.params;
const article = await getArticleBySlug(slug);
const enabled = microcmsEnabled();

if (!article) {
  // 404
  throw new Error(`Article not found: ${slug}`);
}
---

<BaseLayout title={article.title}>
  {!enabled && (
    <p style="color:#666;">
      ※ microCMS が未設定のため、サンプル記事を表示しています（デプロイ確認用）。
    </p>
  )}

  <h1>{article.title}</h1>
  {article.description && <p style="color:#555; line-height:1.8;">{article.description}</p>}
  <article set:html={article.body}></article>

  <p><a href="/articles/">← 記事一覧へ</a></p>
</BaseLayout>
